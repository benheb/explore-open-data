var map;require(["esri/map","dojo/request","esri/geometry/Circle","esri/symbols/SimpleFillSymbol","esri/graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/FeatureLayer","dojo/domReady!"],function(e,t,a,r,i,s,o,l,n){function u(e){var t={geometry:{x:e.geometry.x,y:e.geometry.y,spatialReference:{wkid:102100}},attributes:{title:e.attributes.title,datasets:e.attributes.datasets_count,url:e.attributes.url,groups:e.attributes.groups_count},symbol:{color:[237,50,133,128],size:Math.min(Math.round(e.attributes.datasets_count/100*40),50),angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[171,23,89,200],width:1,type:"esriSLS",style:"esriSLSSolid"}}},a=new i(t);d.add(a)}function p(e){var t=e.graphic.attributes.datasets,a=e.graphic.attributes.title,r=e.graphic.attributes.groups;$("#title").html(a),$("#groups").html("Open Data Groups: "+r),$("#count").html("Datasets: "+t)}function c(e){""!==e.graphic.attributes.url&&null!==e.graphic.attributes.url&&window.open(e.graphic.attributes.url)}esriConfig.defaults.map.basemaps.dotted={baseMapLayers:[{url:"http://studio.esri.com/arcgis/rest/services/World/WorldBasemapBlack/MapServer"}],title:"dots"},map=new e("map",{center:[-56.049,38.485],zoom:3,basemap:"dotted"});var d=new s({id:"circles"});map.addLayer(d),d.on("mouse-over",function(e){p(e)}),d.on("click",function(e){c(e)}),d.on("mouse-out",function(){}),t("http://opendata.arcgis.com/explore.json").then(function(e){var t,a=JSON.parse(e).sites;a.forEach(function(e){var a,r=e.default_extent.xmin+(e.default_extent.xmax-e.default_extent.xmin)/2,i=e.default_extent.ymin+(e.default_extent.ymax-e.default_extent.ymin)/2;if(e.default_extent.spatialReference)if(4326===e.default_extent.spatialReference.wkid){var s=n.lngLatToXY(r,i);a={x:s[0],y:s[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else a={x:r,y:i,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};else if(4326===e.default_extent.spatial_reference.wkid){var s=n.lngLatToXY(r,i);a={x:s[0],y:s[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else a={x:r,y:i,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};t={geometry:a,attributes:{title:e.title,url:e.url,created_at:e.created_at,updated_at:e.updated_at,"public":e.public,groups_count:e.groups_count,datasets_count:e.datasets_count}},u(t)})})});