var map;require(["esri/map","dojo/request","esri/geometry/Circle","esri/layers/ArcGISTiledMapServiceLayer","esri/symbols/SimpleFillSymbol","esri/graphic","esri/layers/GraphicsLayer","esri/geometry/Point","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/FeatureLayer","dojo/domReady!"],function(e,t,a,i,r,s,o,l,n,u){function c(e){var t={geometry:{x:e.geometry.x,y:e.geometry.y,spatialReference:{wkid:102100}},attributes:{title:e.attributes.title,datasets:e.attributes.datasets_count,url:e.attributes.url,groups:e.attributes.groups_count},symbol:{color:[237,50,133,128],size:Math.min(Math.round(e.attributes.datasets_count/100*40),50),angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[210,210,210,170],width:.7,type:"esriSLS",style:"esriSLSSolid"}}},a=new s(t);f.add(a)}function p(e,t){var a=e.symbol;t?(a.color.a=.75,a.outline.width=3,a.outline.color.a=1,e.setSymbol(a)):(a.color.a=.5,a.outline.width=1,a.outline.color.a=.85,e.setSymbol(a))}function d(e){var t=e.graphic.attributes.datasets,a=e.graphic.attributes.title,i=e.graphic.attributes.groups;$("#title").html(a),$("#groups").html("Open Data Groups: "+i),$("#count").html("Datasets: "+t)}function y(e){""!==e.graphic.attributes.url&&null!==e.graphic.attributes.url&&window.open(e.graphic.attributes.url)}map=new e("map",{center:[-50.049,32.485],zoom:3,basemap:"satellite"});var f=new o({id:"circles"});map.addLayer(f),f.on("mouse-over",function(e){p(e.graphic,!0),d(e)}),f.on("mouse-out",function(e){p(e.graphic,!1)}),f.on("click",function(e){y(e)}),f.on("mouse-out",function(){}),t("data/explore-032515.json").then(function(e){var t,a=JSON.parse(e).sites;a.forEach(function(e){var a,i=e.default_extent.xmin+(e.default_extent.xmax-e.default_extent.xmin)/2,r=e.default_extent.ymin+(e.default_extent.ymax-e.default_extent.ymin)/2;if(e.default_extent.spatialReference)if(4326===e.default_extent.spatialReference.wkid){var s=u.lngLatToXY(i,r);a={x:s[0],y:s[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else a={x:i,y:r,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};else if(4326===e.default_extent.spatial_reference.wkid){var s=u.lngLatToXY(i,r);a={x:s[0],y:s[1],type:"point",spatialReference:{latestWkid:3857,wkid:102100}}}else a={x:i,y:r,type:"point",spatialReference:{latestWkid:3857,wkid:102100}};t={geometry:a,attributes:{title:e.title,url:e.url,created_at:e.created_at,updated_at:e.updated_at,"public":e.public,groups_count:e.groups_count,datasets_count:e.datasets_count}},c(t)})})});